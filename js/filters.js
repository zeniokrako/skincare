window.INTERACTION_DATA = {"glycerin:acne-prone": {"score": 0.2, "notes": "Non-comedogenic, does not clog pores. Safe and beneficial for acne-prone skin by maintaining hydration without causing breakouts."}, "glycerin:aging": {"score": 0.3, "notes": "Helps maintain skin hydration and barrier function which supports anti-aging. Not a direct anti-aging active but beneficial overall."}, "glycerin:comedogenic": {"score": -0.5, "notes": "Non-comedogenic - does not clog pores. Lightweight, easily absorbed into skin."}, "glycerin:contact-dermatitis": {"score": 0.2, "notes": "Generally well-tolerated. Rarely causes contact reactions. Helps maintain skin barrier."}, "glycerin:dehydrated": {"score": 0.9, "notes": "Primary function is hydration. One of the most effective humectants, attracting water to the skin."}, "glycerin:eczema": {"score": 0.7, "notes": "Excellent for eczema. Helps restore and maintain compromised skin barrier. Widely used in eczema treatment products."}, "glycerin:fragrance-sensitivity": {"score": -0.5, "notes": "Not a fragrance or sensitizer. Odorless, non-toxic. Does not cause fragrance-related reactions."}, "glycerin:fungal-prone": {"score": 0.1, "notes": "Has antimicrobial properties. Not a fatty acid that feeds Malassezia. Generally considered fungal-safe but limited specific research."}, "glycerin:hyperpigmentation": {"score": 0.0, "notes": "No direct brightening or darkening effect. Maintains skin health but does not specifically target pigmentation."}, "glycerin:irritation": {"score": -0.4, "notes": "Non-irritating, can be soothing. Helps alleviate irritation and redness when used in formulations."}, "glycerin:oily-skin": {"score": 0.2, "notes": "Non-greasy, lightweight. Does not add oiliness. Suitable for oily skin types."}, "glycerin:photosensitivity": {"score": 0.0, "notes": "Does not increase sun sensitivity. No photoprotective properties either. Neutral."}, "glycerin:pregnancy-safety": {"score": 0.5, "notes": "Safe for use during pregnancy and breastfeeding. No known concerns. Widely used in gentle formulations."}, "glycerin:psoriasis": {"score": 0.4, "notes": "Helps hydrate dry, flaky psoriasis plaques. Supports skin barrier function."}, "glycerin:rosacea": {"score": 0.3, "notes": "Gentle and well-tolerated. Helps maintain skin barrier which can reduce rosacea flares."}, "glycerin:seb-derm": {"score": 0.0, "notes": "Generally considered safe. Not a fatty acid that feeds Malassezia yeast. Some uncertainty remains."}, "glycerin:sensitive-skin": {"score": 0.5, "notes": "Very well-tolerated by sensitive skin. Gentle, soothing properties. Helps alleviate irritation and redness."}, "glycerin:xerosis": {"score": 0.9, "notes": "Gold standard humectant for very dry skin. Can absorb its own weight in water. One of the most effective moisturizing ingredients."}, "niacinamide:acne-prone": {"score": 0.8, "notes": "Excellent for acne. Reduces sebum production, has anti-inflammatory properties, helps prevent breakouts. Well-researched."}, "niacinamide:aging": {"score": 0.7, "notes": "Anti-aging benefits. Reduces fine lines, improves skin elasticity, evens skin tone. Stimulates collagen production."}, "niacinamide:comedogenic": {"score": -0.4, "notes": "Non-comedogenic. Actually helps prevent clogged pores by regulating sebum production."}, "niacinamide:contact-dermatitis": {"score": 0.2, "notes": "Generally well-tolerated. Barrier-supporting properties helpful. Rare sensitization."}, "niacinamide:dehydrated": {"score": 0.6, "notes": "Helps dehydrated skin by strengthening barrier function and reducing trans-epidermal water loss."}, "niacinamide:eczema": {"score": 0.5, "notes": "Helpful for eczema due to barrier-strengthening properties. Stimulates ceramide production. Anti-inflammatory."}, "niacinamide:fragrance-sensitivity": {"score": 0.0, "notes": "Not a fragrance or sensitizer. Odorless active ingredient."}, "niacinamide:fungal-prone": {"score": 0.0, "notes": "No specific interaction. Not known to feed or inhibit Malassezia. Neutral."}, "niacinamide:hyperpigmentation": {"score": 0.8, "notes": "Very effective. Blocks melanin transfer rather than production. Clinical studies show significant improvement in hyperpigmentation with 5% concentration."}, "niacinamide:irritation": {"score": 0.2, "notes": "Low irritation potential at normal concentrations (2-5%). Higher concentrations (5-10%) may irritate sensitive skin. Generally well-tolerated."}, "niacinamide:oily-skin": {"score": 0.8, "notes": "Excellent for oily skin. Regulates sebum production, reduces shine. Well-researched benefit."}, "niacinamide:photosensitivity": {"score": -0.2, "notes": "Does not increase sun sensitivity. May offer some photoprotective benefits. Can be used day or night."}, "niacinamide:pregnancy-safety": {"score": 0.5, "notes": "Safe for use during pregnancy. No known concerns. Often recommended as pregnancy-safe alternative to retinoids."}, "niacinamide:psoriasis": {"score": 0.3, "notes": "Anti-inflammatory properties may help. Supports skin barrier. Limited specific research."}, "niacinamide:rosacea": {"score": 0.7, "notes": "Very beneficial for rosacea. Anti-inflammatory, reduces facial redness. Used as first-line treatment. Improvements seen in 2 weeks."}, "niacinamide:seb-derm": {"score": 0.3, "notes": "May help by regulating sebum and reducing inflammation. Limited specific research for seb derm."}, "niacinamide:sensitive-skin": {"score": 0.3, "notes": "Generally well-tolerated but can irritate very sensitive skin at higher concentrations (5-10%). Start with lower concentrations."}, "niacinamide:xerosis": {"score": 0.5, "notes": "Helpful for dry skin. Strengthens barrier, stimulates ceramide production, reduces trans-epidermal water loss."}, "panthenol:acne-prone": {"score": 0.2, "notes": "Generally safe for acne-prone skin. Non-comedogenic. Wound healing properties may help with acne scarring."}, "panthenol:aging": {"score": 0.3, "notes": "Supports skin regeneration and barrier function. Not a primary anti-aging active but beneficial for overall skin health."}, "panthenol:comedogenic": {"score": -0.3, "notes": "Non-comedogenic. Does not clog pores. Lightweight hydration."}, "panthenol:contact-dermatitis": {"score": 0.4, "notes": "Helpful for dermatitis. Anti-inflammatory, soothing. Rarely causes sensitization."}, "panthenol:dehydrated": {"score": 0.8, "notes": "Excellent for dehydrated skin. Both humectant (attracts water) and emollient (seals it in). Clinically proven to improve hydration."}, "panthenol:eczema": {"score": 0.7, "notes": "Excellent for eczema. Reduces flare-ups and frequency. Strengthens skin barrier, promotes healing, anti-inflammatory."}, "panthenol:fragrance-sensitivity": {"score": -0.2, "notes": "Not a fragrance or sensitizer. Gentle active ingredient."}, "panthenol:fungal-prone": {"score": 0.0, "notes": "No specific interaction. Not known to feed or inhibit fungi. Neutral."}, "panthenol:hyperpigmentation": {"score": 0.1, "notes": "May help indirectly through wound healing and skin regeneration. Not a primary treatment for hyperpigmentation."}, "panthenol:irritation": {"score": -0.5, "notes": "Very low irritation potential. Actually soothing and anti-inflammatory. Used to treat irritated and inflamed skin."}, "panthenol:oily-skin": {"score": 0.1, "notes": "Safe for oily skin. Lightweight hydration without heaviness. Non-comedogenic."}, "panthenol:photosensitivity": {"score": -0.3, "notes": "Does not increase sun sensitivity. Actually helps soothe UV-induced redness. Often used in after-sun products."}, "panthenol:pregnancy-safety": {"score": 0.5, "notes": "Safe for use during pregnancy. No known concerns. Gentle and well-tolerated."}, "panthenol:psoriasis": {"score": 0.4, "notes": "May help with psoriasis. Promotes skin regeneration, anti-inflammatory. Supports barrier function."}, "panthenol:rosacea": {"score": 0.5, "notes": "Beneficial for rosacea. Anti-inflammatory, soothing. Helps reduce redness and irritation."}, "panthenol:seb-derm": {"score": 0.2, "notes": "Generally safe. Soothing and anti-inflammatory. Not specifically studied for seb derm."}, "panthenol:sensitive-skin": {"score": 0.6, "notes": "Excellent for sensitive skin. Very gentle, soothing, anti-inflammatory. No known toxicity concerns."}, "panthenol:xerosis": {"score": 0.8, "notes": "Excellent for very dry skin. Both humectant and emollient. Improves hydration and reduces water loss. Well-researched."}, "phenoxyethanol:acne-prone": {"score": 0.0, "notes": "Neutral preservative. Does not affect acne. Non-comedogenic."}, "phenoxyethanol:aging": {"score": 0.0, "notes": "No effect on aging. Functions only as a preservative."}, "phenoxyethanol:comedogenic": {"score": 0.0, "notes": "Non-comedogenic. Does not clog pores."}, "phenoxyethanol:contact-dermatitis": {"score": -0.2, "notes": "Rare sensitizer but can occasionally cause contact reactions in susceptible individuals."}, "phenoxyethanol:dehydrated": {"score": 0.0, "notes": "No hydrating or dehydrating effect."}, "phenoxyethanol:eczema": {"score": -0.3, "notes": "May irritate eczema-prone skin. Patch test recommended. Discontinue if reaction occurs."}, "phenoxyethanol:fragrance-sensitivity": {"score": 0.0, "notes": "Not a fragrance compound. No fragrance-related sensitization."}, "phenoxyethanol:fungal-prone": {"score": 0.1, "notes": "Preservative with antimicrobial properties. Generally neutral to slightly beneficial."}, "phenoxyethanol:hyperpigmentation": {"score": 0.0, "notes": "No effect on pigmentation."}, "phenoxyethanol:irritation": {"score": 0.2, "notes": "Low irritation potential. One of the best-tolerated preservatives. Rare sensitizer but possible in susceptible individuals."}, "phenoxyethanol:oily-skin": {"score": 0.0, "notes": "Neutral. No effect on oil production."}, "phenoxyethanol:photosensitivity": {"score": 0.0, "notes": "Does not increase sun sensitivity."}, "phenoxyethanol:pregnancy-safety": {"score": -0.4, "notes": "Some concern for breastfeeding mothers - FDA warned against nipple creams containing it. May be absorbed through skin. Caution advised during pregnancy/breastfeeding."}, "phenoxyethanol:psoriasis": {"score": 0.0, "notes": "Neutral. No specific interaction with psoriasis."}, "phenoxyethanol:rosacea": {"score": -0.1, "notes": "Generally well-tolerated but may occasionally irritate very sensitive rosacea-prone skin."}, "phenoxyethanol:seb-derm": {"score": 0.0, "notes": "Neutral. No specific interaction with seborrheic dermatitis."}, "phenoxyethanol:sensitive-skin": {"score": -0.2, "notes": "One of the best-tolerated preservatives, but may occasionally irritate highly sensitive skin. Patch test recommended."}, "phenoxyethanol:xerosis": {"score": 0.0, "notes": "Neutral. Does not hydrate or dry skin."}};


document.addEventListener('DOMContentLoaded', function() {
    // Theme toggle
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });
    }

    // Concern tag filtering and ingredient highlighting
    const concernTags = document.querySelectorAll('.concern-tag');
    const productCards = document.querySelectorAll('.product-card');

    // Interaction data: { "ingredient-slug:concern-slug": { score, notes } }
    let interactionData = window.INTERACTION_DATA || {};

    // Concerns where positive score = BAD (inverted from normal)
    // For these: +1 = problematic, -1 = beneficial
    const invertedConcerns = new Set([
        'comedogenic',      // +1 = clogs pores (bad), -1 = non-comedogenic (good)
        'photosensitivity', // +1 = increases sun sensitivity (bad), -1 = photoprotective (good)
        'irritation',       // +1 = irritating (bad), -1 = soothing (good)
        'fragrance-sensitivity' // +1 = contains sensitizers (bad), -1 = fragrance-free (good)
    ]);

    // Track selected concerns
    let selectedConcerns = new Set();

    function updateHighlighting() {
        // Reset all ingredient highlights
        document.querySelectorAll('.ingredients-list .ingredient').forEach(el => {
            el.classList.remove('good', 'bad');
            el.removeAttribute('title');
        });

        if (selectedConcerns.size === 0) {
            return;
        }

        // Highlight ingredients based on selected concerns
        productCards.forEach(card => {
            const ingredients = card.querySelectorAll('.ingredients-list .ingredient');

            ingredients.forEach(ingEl => {
                const ingSlug = ingEl.dataset.slug;
                let bestScore = null;
                let bestNotes = '';
                let isInverted = false;

                // Check each selected concern for this ingredient
                selectedConcerns.forEach(concern => {
                    const key = `${ingSlug}:${concern}`;
                    const data = interactionData[key];
                    if (data !== undefined) {
                        let score = typeof data === 'object' ? data.score : data;
                        const notes = typeof data === 'object' ? data.notes : '';

                        // For inverted concerns, flip the score for comparison
                        const effectiveScore = invertedConcerns.has(concern) ? -score : score;

                        // Use the most extreme effective score
                        if (bestScore === null || Math.abs(effectiveScore) > Math.abs(bestScore)) {
                            bestScore = effectiveScore;
                            bestNotes = notes;
                        }
                    }
                });

                // Apply highlighting (now bestScore is normalized: positive = good, negative = bad)
                if (bestScore !== null) {
                    if (bestScore > 0.3) {
                        ingEl.classList.add('good');
                        if (bestNotes) ingEl.setAttribute('title', bestNotes);
                    } else if (bestScore < -0.3) {
                        ingEl.classList.add('bad');
                        if (bestNotes) ingEl.setAttribute('title', bestNotes);
                    }
                }
            });
        });
    }

    // Handle concern tag clicks
    concernTags.forEach(tag => {
        tag.addEventListener('click', function() {
            const concern = this.dataset.concern;

            if (selectedConcerns.has(concern)) {
                selectedConcerns.delete(concern);
                this.classList.remove('active');
            } else {
                selectedConcerns.add(concern);
                this.classList.add('active');
            }

            updateHighlighting();
        });
    });

    // Ingredient search
    const ingredientSearch = document.getElementById('ingredient-search');
    if (ingredientSearch) {
        ingredientSearch.addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const items = document.querySelectorAll('.ingredient-item');

            items.forEach(item => {
                const name = item.querySelector('h3')?.textContent.toLowerCase() || '';
                item.style.display = name.includes(query) ? '' : 'none';
            });

            // Show/hide letter sections
            document.querySelectorAll('.letter-section').forEach(section => {
                const visibleItems = section.querySelectorAll('.ingredient-item:not([style*="display: none"])');
                section.style.display = visibleItems.length > 0 ? '' : 'none';
            });
        });
    }
});
